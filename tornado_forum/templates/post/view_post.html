
{% extends 'core/home.html' %}
{% block title %}
    Tornado Forum
{% end %}
{% block style %}
    <link rel="stylesheet" href="https://cdn.ckeditor.com/ckeditor5/46.1.0/ckeditor5.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{{ static_url('css/view_post.css') }}">
    <style>
        .comment-container {
            margin-left: 20px;
            border-left: 1px solid #ccc;
            padding-left: 10px;
        }
        .comment-main {
            display: flex;
        }
        .comment-toggle {
            cursor: pointer;
            margin-right: 5px;
        }
        .children {
            margin-left: 30px;
        }
    </style>
{% end %}
{% block content %}
    <div class="topic-page" id="{{ topic['id'] }}">
        <div class="topic-details">
            <a href="/{{topic['user']['id']}}/{{topic['user']['username']}}">
                <p>{{topic['user']['username']}}</p>
            </a>
            <h2>{{ topic['title'] }}</h2>
            <p>{{ topic['content'] }}</p>
        </div>
        <div class="topic-meta">
            <div class="topic-votes">
                <i class="fa-solid fa-arrow-up vote-btn" data-vote-type="1" data-topic-id="{{ topic['id'] }}"></i>
                <span class="score">{{ topic['score'] }}</span>
                <i class="fa-solid fa-arrow-down vote-btn" data-vote-type="-1" data-topic-id="{{ topic['id'] }}"></i>
            </div>
            <i class="fa-solid fa-reply"></i>
        </div>
        <div id='thread-reply' data-url="/topic/{{topic['id']}}/comment/create" style="display: none;">
            <div id='editor'></div>
            <div class="handle-comment">
                <button value="Reply" class="reply-comment" type="button">Reply</button>
                <button value="Cancel" class="cancel-comment" type="button">Cancel</button>
            </div>
        </div>
        <div class="comments-section">
            {% for comment in topic['comments'] %}
            <div class="top-level-comment">
                {% module Comment(comment) %}
            </div>
            {% end %}
        </div>
    </div>
{% end %}

{% block javascript %}
    <script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/classic/ckeditor.js"></script>
    <script src="{{ static_url('js/utils.js') }}"></script>
    <script src="{{ static_url('js/handleVote.js') }}"></script>
    <script src="{{ static_url('js/createComment.js') }}"></script>
    <script src="{{ static_url('js/handleComments.js') }}"></script>
    <script defer>
        const arrangeCommentsInRedditStyle = ()=>{
            const allComments = document.querySelectorAll('.comment');
            allComments.forEach((comment)=>{
                configureCommentStyling(comment)
            })
        }

        const configureCommentStyling = (commentElement)=>{
            /*
            We are getting the parent element of the commentElement.
            We check if the parentElement has the commentDepth data, if not we will set it to 1.
            (If there is no commentDepth data, then it is the parent comment.)
            We set the margin-left of the comment to 40*commentDepth px.
            */
            const parentElement = commentElement.parentElement
            const commentDepth = parentElement.dataset.commentDepth || 0
            commentElement.style.marginLeft = `${20*(commentDepth-1)}px`
        }
        arrangeCommentsInRedditStyle()
    </script>
{% end %}
